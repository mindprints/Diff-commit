# Diff-commit Handoff (2026-02-21)

## Scope Completed Today
- Introduced a new Prompt-graph-based universal graph modal and wired it to the graph entrypoint.
- Implemented repo selection zones and project drag/drop behavior in the universal modal.
- Added backend + preload + renderer plumbing for actual cross-repo project moves.
- Iterated UI placement/behavior for repo zones per feedback.

## Current Behavior (End-of-day)
- Opening graph now uses: `src/renderer/components/UniversalGraphModal.tsx`
- Graph shows **project pills** for the currently loaded repo.
- There are **3 repo zone pills** (fixed set, persisted in localStorage key `diff-commit-universal-drop-repos-v1`).
- Repo zones are currently:
  - top-row initial layout
  - draggable/unfrozen (can be repositioned)
  - clickable to load/display that repoâ€™s projects
  - valid drop targets for project move
- Dragging a project pill onto a repo zone:
  1. moves project to target repo
  2. switches to target repo
  3. flashes receiving zone on success
- Project content tooltips are hidden while dragging.
- Project default placement wraps in a grid (not single long row).

## Move API Added (Important)
- Main process IPC:
  - `move-project-to-repository` in `src/main/index.ts`
- Preload bridge:
  - `moveProjectToRepository` in `src/preload/index.ts`
- Renderer typing:
  - `moveProjectToRepository` in `src/renderer/electron.d.ts`
- Hook + context plumbing:
  - `moveProjectToRepositoryById` in `src/renderer/hooks/useProjects.ts`
  - exposed via `ProjectContext` in `src/renderer/contexts/ProjectContext.tsx`
- Modal wiring:
  - `onMoveProject` path in `src/renderer/components/AppModals.tsx`

## Files Touched (Primary)
- `src/renderer/components/UniversalGraphModal.tsx`
- `src/renderer/components/AppModals.tsx`
- `src/renderer/hooks/useProjects.ts`
- `src/renderer/contexts/ProjectContext.tsx`
- `src/main/index.ts`
- `src/preload/index.ts`
- `src/renderer/electron.d.ts`

## Known Quirks / Follow-up
- User observed one extra click before moved project appears in some flows; currently acceptable, but should be smoothed.
- Repo zone dragging is implemented with window mouse listeners in modal; should be reviewed for polish/cleanup.
- No commit/diff pills in this universal flow yet (explicitly deferred).
- No dedicated tests yet for `move-project-to-repository` IPC path; only typecheck + existing targeted graph tests run.

## Validation Run Today
- `npx tsc --noEmit` (passing after each major patch)
- `npx vitest run src/renderer/components/graph/graphMath.test.ts src/renderer/services/graphService.test.ts` (passing)

## Suggested Next Steps (Tomorrow)
1. Stabilize move-refresh UX:
   - remove need for extra click after move
   - ensure immediate source/target project list consistency
2. Add guarded UX around move conflicts:
   - clearer toast when target repo already has same project folder name
3. Add small integration tests for move path (renderer hook + IPC contract).
4. Then continue feature layering (commits/diffs lane, quick actions, etc.) per agreed incremental approach.

